{"version":3,"sources":["src/lib/api.js","src/lib/errorHandler.js","src/lib/killer.js","src/lib/logger.js","src/lib/view.js","src/servomatic.js","src/static/index.js"],"names":[],"mappings":"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","file":"servomatic.js","sourcesContent":["import {Router as router} from 'express';\nimport {get} from 'http';\n\nexport var api = router()\n\nvar debugLogging = true\n  , lastRequestFinished = true\n  , lastUrl\n;\n\nfunction debugLog(str) {\n  if ( debugLogging ) {\n    console.log(str);\n  }\n}\n\napi.use( (req, res, next) => {\n  var url = `http://127.0.0.1:8080${req.originalUrl}`;\n  debugLog(`loading url: ${url}`);\n\n  get(url, (result) => {\n    debugLog(`slackomatic get res ${result.statusCode}`);\n    res.status(200).send(`Slackomatic get request <span color=\"green\">succeeded</span>: redirected request to backend url ${url}`);\n  }).on('error', (e) => {\n    debugLog(\"Got error: \" + e.errno);\n    res.status(500).send(`Slackomatic <span color=\"red\">${e.errno} errored</span>: ${e.message}`);\n  });\n});\n\nexport default api;\n","export var errorHandler = {\n  //development errorHandler, renders error page\n  development(err, req, res, next) {\n    var message = {\n      message: err.message,\n      error: err\n    };\n    res.status(err.status || 500)\n       .send(`error : ${JSON.stringify(message)}`)\n    ;\n  },\n\n  // production error handler\n  // no stacktraces leaked to user\n  production(err, req, res, next) {\n    res.status(err.status || 500).send('error');\n  }\n};\n\nexport default errorHandler;\n","import {Router as router} from 'express';\n\nexport var killer = router();\n\nkiller.get('/killkillkill', (req, res, next) => {\n  res.status(200).send('killed process');\n  process.exit(0);\n});\n\nexport default killer;\n","//logging middleware\nimport morgan from 'morgan';\nimport {join} from 'path';\nimport {createWriteStream as wStream, existsSync} from 'fs';\nimport merge from 'magic-merge';\nimport {each} from 'magic-loops';\nimport mkdirp from 'mkdirp';\n\nvar self;\n\nclass Logger {\n  constructor(app, opts = {}) {\n    var cwd         = process.cwd()\n      , defaultDir  = join('/var', 'log', 'servomatic')\n    ;\n\n    self     = this;\n    self.dir = opts.dir || join(cwd, 'log')\n\n    if ( ! existsSync(self.dir) ) {\n      console.log(`log dir at ${self.dir} does not exist, creating ${defaultDir}`);\n      self.dir = defaultDir;\n      mkdirp(self.dir, {mode: 644} );\n    }\n\n    self.logs = merge(opts, {\n        access: {\n          stream: wStream( join(self.dir, 'access.log'), {flags: 'a'} )\n        , skip: function (req, res) { return res.statusCode >= 400 }\n      }\n      , err   : {\n          stream: wStream( join(self.dir, 'error.log'), {flags: 'a'} )\n        , skip: function (req, res) { return res.statusCode < 400 }\n      }\n    });\n\n    self.app = app;\n  }\n\n  middleware() {\n    each(self.logs, (log) => {\n      self.app.use( morgan('default', log) )\n    });\n  }\n}\n\nexport default Logger;\n","export function view(req, res, next) {\n  res.render('pages/' + req.params.page, (err, html) => {\n    if ( err || ! html ) { next(err); }\n\n    res.status(200).send(html);\n  });\n}\n\nexport default view;\n","import express from 'express';\nimport {get} from 'http';\nimport {join} from 'path';\nimport Favicon from 'magic-favicon';\nimport {existsSync} from 'fs';\nimport minimist from 'minimist';\n\nvar servomatic = express()\n  , env   = servomatic.get('env')\n  , cwd   = process.cwd()\n  , argv  = minimist( process.argv.slice(2) )\n;\n\nif ( argv.dir && typeof argv.dir === 'string' ) {\n  if ( argv.dir.indexOf('/') === 0 ) {\n    cwd = argv.dir;\n  } else {\n    cwd = join( cwd, argv.dir );\n  }\n}\n\nvar dirs = {\n      static   : join(cwd, 'static')\n    , public   : join(cwd, 'public')\n    , views    : join(cwd, 'views')\n    , favicon  : join(cwd, 'favicon.ico')\n    , worstCase: join(__dirname, 'dist')\n  }\n  , logger = new Logger( servomatic )\n;\n\nconsole.log(`executing in cwd: ${cwd}`);\n\nservomatic.set('port', process.env.PORT || 80);\n\n// view engine setup for the rare cases where no html file exists\nservomatic.set('views', dirs.views);\nservomatic.set('view engine', 'jade');\n\nnew Favicon(servomatic, dirs.favicon);\n\n//if requested path exists in /public it gets served from there\nservomatic.use( express.static(dirs.public) );\n\nlogger.middleware(servomatic);\n\n//servomaticomatic api redirect\nservomatic.use('/slackomatic/*', api);\n\nservomatic.use(killer);\n\nservomatic.use( express.static( dirs.static, {\n  extensions: ['html'] //automatically add html extension to urls\n, index: ['index.html'] //always load index.html files on /\n}));\n\n//renders :page from views/pages if static html does not exist\nservomatic.use('/:page', view);\n\nservomatic.use( express.static(dirs.worstCase) );\n\n// catch 404 and forwarding to error handler\nservomatic.use( (req, res, next) => {\n  var err = new Error('Not Found');\n  err.status = 404;\n  next(err);\n});\n\n// error handlers\n// development error handler prints stacktrace\nif ( ! errorHandler.hasOwnProperty(env) ) {\n  env = 'production';\n}\n\nservomatic.use( errorHandler[env] );\n\nservomatic.listen( servomatic.get('port'), () => {\n  console.log(`servomatic listens on port : ${servomatic.get('port')}`);\n} );\n","(function() {\n  console.log('hello world');\n})();\n"]}